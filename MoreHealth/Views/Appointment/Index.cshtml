@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-talon" role="tab" aria-controls="nav-home" aria-selected="true">Талон</a>
        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-profile" aria-selected="false">Врач на дом</a>
    </div>
</nav>

<div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-talon" role="tabpanel" aria-labelledby="nav-home-tab">
        <p></p>
        <input id="doctor" style="width: 40%;" />
        <p></p>
        <input id="datepicker" value="11/12/2021" title="datepicker" style="width: 40%" />
        <p></p>
        <input id="talons" style="width: 40%;" />
        <p></p>
        <input id="address" style="width: 40%;" />
        <p></p>
        <button id="textButton">Заказать</button>
    </div>
    <div class="tab-pane fade" id="nav-home" role="tabpanel" aria-labelledby="nav-profile-tab">
        <input id="address2" style="width: 40%;" />
        <button id="callingdoctorathome">Заказать</button>
    </div>
</div>
<script>
    $("#doctor").kendoDropDownList({
        dataTextField: "fullName",
        dataValueField: "id",
        optionLabel: "Выберите врача...",
        height: 500,
        dataSource: {
            transport: {
                read: {
                    url: "@Url.Action("GetAllDoctors", "FeedBack")",
                    dataType: "json",
                    cache: false
                }
            }
        }
    });

    $("#datepicker").kendoDatePicker({
        value: new Date("@DateTime.Now.ToString("yyyy-M-d")"),
        change: onChange
    })

    function onChange() {
        $("#talons").kendoDropDownList({
            dataTextField: "getDate",
            dataValueField: "id",
            optionLabel: "Выберите талон",
            height: 500,
            dataSource: {
                transport: {
                    read: {
                        url: "@Url.Action("GetTalonsByDoctorDate", "Appointment")",
                        data: function () {
                            var datapicker = $("#datepicker").data("kendoDatePicker").value();
                            var t = kendo.toString(datapicker, "dd/MM/yyyy");
                            return {
                                doctor: $("#doctor").data("kendoDropDownList").value(),
                                talon1: kendo.toString(datapicker, "dd/MM/yyyy")
                            };
                        }
                    }

                }
            }
        });
    }

    $("#address").kendoTextBox({
        placeholder: "Адрес",
        label: {
            content: "адрес",
            floating: true
        }
    });

    $("#address2").kendoTextBox({
        placeholder: "Адрес",
        label: {
            content: "адрес",
            floating: true
        }
    });

    $("#callingdoctorathome").kendoButton({
        click: submitCalling
    });

    $("#textButton").kendoButton({
        click: onClick
    });

    function submitCalling() {
        const address = $("#address2").data("kendoTextBox").value()
        console.log(address);
        var userId = "@User.Claims.ElementAt(0).Value";
        $.ajax({
            url: `/Appointment/CallingDoctorHome/?address=${address}&userid=${userId}`,
            type: 'post',
            success: function (response) {
                console.log(response)
                alert(response);
            },
            error: function (response) {
                alert(response);
            }
        });
    }

    function onClick() {
        const talonId = $("#talons").data("kendoDropDownList").value()
        const address = $("#address").data("kendoTextBox").value()
        var userId = "@User.Claims.ElementAt(0).Value";
        $.ajax({
            url: `/Appointment/AddPatientTalon/?talon=${talonId}&address=${address}&userid=${userId}`,
            type: 'post',
            success: function (response) {
                console.log(response)
                alert(response);
            },
            error: function (response) {
                alert(response);
            }
        });
    }


</script>
