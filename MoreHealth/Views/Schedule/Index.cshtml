@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div id="ticketPlan"></div>
<script id="customEditorTemplate" type="text/x-kendo-template">
    <!-- notice how the Title is hidden if the event is new -->
    <div class="k-edit-label">
        <label for="start">Start</label>
      </div>
    <div data-container-for="start" class="k-edit-field">
        <input type="text"
            data-role="datetimepicker"
            data-interval="15"
            data-type="date"
            data-bind="value:StartDate,invisible:isAllDay"
            name="StartDate"
            style="width: 60%;" />
        <input type="text"
            data-type="date"
            data-role="datepicker"
            data-bind="value:StartDate,visible:isAllDay"
            name="StartDate"
            style="width: 60%;"/>
        <span data-bind="text: startTimezone"></span>
        <span data-for="start" class="k-invalid-msg" style="display: none;"></span>
      </div>
    <div class="k-edit-label"><label for="end">End</label></div>
    <div data-container-for="end" class="k-edit-field" >
        <input type="text"
            data-type="date"
            data-role="datetimepicker"
            data-bind="value:EndDate,invisible:isAllDay"
            name="EndDate"
            data-datecompare-msg="End date should be greater than or equal to the start date"
            style="width: 60%;" />
        <input type="text"
            data-type="date"
            data-role="datepicker"
            data-bind="value:EndDate,visible:isAllDay"
            name="EndDate"
            data-datecompare-msg="End date should be greater than or equal to the start date"
            style="width: 60%;" />
        <span data-bind="text: endTimezone"></span>
        <span data-bind="text: startTimezone, invisible: endTimezone"></span>
        <span data-for="end" class="k-invalid-msg" style="display: none;"></span>
      </div>
    <div class="k-edit-label"><label for="ownerId">Врач</label></div>
    <div class="k-edit-field">
        <input id="DoctorId" style="width: 60%;" />
    </div>
    <div class="k-edit-label"><label for="recurrenceRule">Repeat</label></div>
    <div data-container-for="recurrenceRule" class="k-edit-field">
        <div data-bind="value:RecurrenceRule" name="recurrenceRule" data-role="recurrenceeditor"></div>
      </div>
</script>   

<script>
var date = "FREQ=WEEKLY;BYDAY=TU,TH"
    $(function () {
        $("#ticketPlan").kendoScheduler({
            date: new Date("2021/12/05"),
            startTime: new Date("2021/12/05 07:00 AM"),
            height: 600,
            views: [
                "day",
                { type: "workWeek", selected: true },
                "week",
                "month",
                "agenda"
            ],
            timezone: "Europe/Minsk",
            editable: {
                window: {
                    width: 640,
                    scrollable: false,
                    resizable: false
                },
                template: $("#customEditorTemplate").html()
            },
            edit: function (e) {
                $("#DoctorId").kendoDropDownList({
                    dataTextField: "fullName",
                    dataValueField: "id",
                    optionLabel: "Выберите врача...",
                    height: 500,
                    dataSource: {
                        transport: {
                            read: {
                                url: "@Url.Action("GetAllDoctors", "FeedBack")",
                                dataType: "json",
                                cache: false
                            }
                        }
                    }
                })
            },
            dataSource: {
                batch: true,
                transport: {
                    //create: function (options) {
                    //    CreateEvent("/Appointment/AddEvent", options);
                    //},
                    create: {
                        url: "/Appointment/AddEvent",
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        type: "POST"
                        },
                    read: {
                        url: "/Appointment/GetAllTalons",
                        dataType: "json"
                    }
                },
                schema: {
                    model: {
                        id: "taskId", // (Mandatory) The "id" of the event is the "taskId" field.
                        fields: {
                            // Describe the Scheduler event fields and map them to the fields returned by the remote service.
                            taskId: {
                                from: "Id", // The 'TaskID' server-side field is mapped to the 'taskId' client-side field.
                                type: "number"
                            },
                            start: {
                                type: "date",
                                from: "dateStart" // The 'Start' server-side field is mapped to the 'start' client-side field.
                            },
                            end: {
                                type: "date",
                                from: "dateEnd" // The 'End' server-side field is mapped to the 'end' client-side field.
                            },
                            recurrenceRule: {from : "recurrenceRule"}
                        }
                    }
                }
            }
        });
    });
    //function CreateEvent(url, options) {
    //    console.log(options);
    //    $.ajax({
    //        url: url,
    //        contentType: "application/json",
    //        type: "POST",
    //        data: JSON.stringify({
    //            gap: options.data,
    //        }),
    //        success: function (result) {
    //            options.success(result);
    //        },
    //        error: function (result) {
    //            options.error(result);
    //        }
    //    });
    //}
</script>